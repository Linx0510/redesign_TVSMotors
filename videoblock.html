<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Бесконечная карусель видеоотзывов</title>
    <style>
        /* === ОСНОВНЫЕ СТИЛИ КАРУСЕЛИ === */
        .video-comments-container {
            max-width: 1440px;
            margin: 0 auto;
            padding: 60px 0;
            position: relative;
        }

        .video-comments-header {
            text-align: center;
            margin-bottom: 40px;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
            padding: 0 20px;
        }

        .video-comments-impression {
            font-weight: 700;
            font-size: 20px;
            line-height: 23px;
            letter-spacing: -0.3px;
            color: #F97316;
            display: block;
            margin-bottom: 12px;
        }

        .video-comments-title {
            font-weight: 400;
            font-size: 32px;
            line-height: 37px;
            letter-spacing: -0.3px;
            color: #222222;
        }

        .video-comments-wrapper {
            overflow-x: auto;
            overflow-y: hidden;
            position: relative;
            scrollbar-width: none;
            scroll-behavior: smooth;
            -ms-overflow-style: none;
            cursor: grab;
        }

        .video-comments-wrapper::-webkit-scrollbar {
            display: none;
        }

        .video-comments-wrapper.grabbing {
            cursor: grabbing;
            scroll-behavior: auto;
        }

        .video-comments-grid {
            display: flex;
            gap: 24px;
            width: max-content;
            min-width: 100%;
            padding: 20px 0;
        }

        .video-comments-card {
            flex: 0 0 auto;
            width: 400px;
            height: 520px;
            background-size: cover;
            background-position: center;
            border-radius: 16px;
            overflow: hidden;
            position: relative;
            cursor: pointer;
            transition: opacity 0.4s ease;
            opacity: 1;
        }

        .video-comments-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(0deg, rgba(0, 0, 0, 0.70) 0%, rgba(0, 0, 0, 0.00) 50%);
            z-index: 1;
        }

        .video-comments-card.faded {
            opacity: 0.5;
        }

        .video-comments-play-container {
            width: 336px;
            height: 430px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 10px;
            opacity: 1;
            position: relative;
            z-index: 2;
            margin: 0 auto;
        }

        .video-comments-play-btn {
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: center;
            padding: 8px;
            gap: 10px;
            width: 74px;
            height: 60px;
            background: rgba(33, 33, 33, 0.6);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 1;
        }

        .video-comments-play-btn:hover {
            background: rgba(33, 33, 33, 0.8);
            transform: scale(1.1);
        }

        .video-comments-play-icon {
            width: 44px;
            height: 44px;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 1;
        }

        .video-comments-play-icon::before {
            content: '';
            position: absolute;
            width: 26.4px;
            height: 26.7px;
            background: #F97316;
            clip-path: polygon(0 0, 100% 50%, 0 100%);
            margin-left: 2px;
        }

        .video-comments-text-container {
            width: 336px;
            height: 56px;
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 8px;
            opacity: 1;
            position: relative;
            z-index: 2;
            margin: 0px !important;
            padding-left: 32px !important;
        }

        .text-content {
            width: 328px;
            height: 41px;
            display: flex;
            flex-direction: column;
            opacity: 1;
        }

        .video-comments-card-title {
            font-weight: 400;
            font-size: 20px;
            line-height: 23px;
            letter-spacing: -0.3px;
            color: #FDFDFD;
            margin: 0px !important;
        }

        .video-comments-car-name {
            font-weight: 400;
            font-size: 13px;
            line-height: 18px;
            letter-spacing: -0.3px;
            color: #FDFDFD;
        }

        .video-comments-text-container::before {
            content: '';
            width: 0px;
            height: 56px;
            border: 2px solid;
        }

        .video-comments-card:nth-child(odd) .video-comments-text-container::before {
            border-color: #F97316;
        }

        .video-comments-card:nth-child(even) .video-comments-text-container::before {
            border-color: #3B82F6;
        }

        /* Градиенты по краям экрана */
        .video-comments-wrapper::before,
        .video-comments-wrapper::after {
            content: '';
            position: absolute;
            top: 0;
            width: 200px;
            height: 100%;
            z-index: 3;
            pointer-events: none;
            transition: opacity 0.4s ease;
            opacity: 0;
        }

        .video-comments-wrapper::before {
            left: 0;
            background: linear-gradient(to right, rgba(60, 60, 60, 0.5), transparent);
        }

       
        .video-comments-wrapper.fade-left::before {
            opacity: 1;
        }

        .video-comments-wrapper.fade-right::after {
            opacity: 1;
        }

        .video-comments-wrapper.fade-both::before,
        .video-comments-wrapper.fade-both::after {
            opacity: 1;
        }

        .video-comments-nav {
            display: none;
        }

        /* === АДАПТИВНОСТЬ === */
        @media (max-width: 768px) {
            .video-comments-container {
                padding: 40px 0;
            }

            .video-comments-title {
                font-size: 20px !important;
                line-height: 24px !important;
            }
            
            .video-comments-header {
                text-align: left;
            }

            .video-comments-wrapper {
                overflow-x: auto;
                overflow-y: hidden;
                position: relative;
                height: auto;
                padding: 0 20px;
            }

            .video-comments-grid {
                display: flex;
                gap: 16px;
                width: max-content;
                min-width: 100%;
                padding: 20px 0;
            }

            .video-comments-card {
                width: 343px;
                height: 520px;
                position: relative;
                opacity: 1;
                transform: none;
                z-index: 1;
            }

            .video-comments-card.active {
                opacity: 1;
                transform: none;
                z-index: 1;
            }

            .video-comments-nav {
                display: flex;
                justify-content: center;
                align-items: center;
                gap: 16px;
                margin-top: 20px;
            }

            .video-comments-arrow {
                background: none;
                border: none;
                cursor: pointer;
                display: flex;
                justify-content: center;
                align-items: center;
                margin-top: 40px;
            }
            
            .video-comments-impression {
                font-size: 16px !important;
            }

            .video-comments-wrapper::before,
            .video-comments-wrapper::after {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="video-comments-container">
        <div class="video-comments-header">
            <span class="video-comments-impression">Живые впечатления</span>
            <h2 class="video-comments-title">Открытые отзывы наших клиентов</h2>
        </div>
        
        <div class="video-comments-wrapper" id="videoCarousel">
            <div class="video-comments-grid" id="videoGrid">
                <!-- Карточки будут добавлены через JavaScript -->
            </div>
        </div>

        <div class="video-comments-nav">
            <button class="video-comments-arrow left-arrow" aria-label="Предыдущий отзыв">
                <svg xmlns="http://www.w3.org/2000/svg" width="82" height="16" viewBox="0 0 82 16" fill="none">
                    <path opacity="0.4" d="M0.792892 8.70711C0.402367 8.31658 0.402367 7.68342 0.792892 7.29289L7.15685 0.928932C7.54738 0.538408 8.18054 0.538408 8.57107 0.928932C8.96159 1.31946 8.96159 1.95262 8.57107 2.34315L2.91422 8L8.57107 13.6569C8.96159 14.0474 8.96159 14.6805 8.57107 15.0711C8.18054 15.4616 7.54738 15.4616 7.15685 15.0711L0.792892 8.70711ZM81.5 8V9H1.5V8V7H81.5V8Z" fill="#3B82F6"/>
                </svg>
            </button>
            <button class="video-comments-arrow right-arrow" aria-label="Следующий отзыв">
                <svg xmlns="http://www.w3.org/2000/svg" width="82" height="16" viewBox="0 0 82 16" fill="none">
                    <path d="M81.2071 8.70711C81.5976 8.31658 81.5976 7.68342 81.2071 7.29289L74.8431 0.928932C74.4526 0.538408 73.8195 0.538408 73.4289 0.928932C73.0384 1.31946 73.0384 1.95262 73.4289 2.34315L79.0858 8L73.4289 13.6569C73.0384 14.0474 73.0384 14.6805 73.4289 15.0711C73.8195 15.4616 74.4526 15.4616 74.8431 15.0711L81.2071 8.70711ZM0.5 8V9H80.5V8V7H0.5V8Z" fill="#3B82F6"/>
                </svg> 
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Данные карточек
            const cardData = [
                {
                    image: './image/new_vide_img1.svg',
                    title: 'Юрий Морозов',
                    carName: 'Chery Tiggo 7 Pro'
                },
                {
                    image: './image/new_vide_img2.svg',
                    title: 'Андрей Пересыпкин',
                    carName: 'Chery Arrizo 8'
                },
                {
                    image: './image/new_vide_img3.svg',
                    title: 'Андрей Пересыпкин',
                    carName: 'Chery Arrizo 8'
                },
                {
                    image: './image/new_vide_img1.svg',
                    title: 'Андрей Пересыпкин',
                    carName: 'Chery Arrizo 8'
                },
                {
                    image: './image/new_vide_img2.svg',
                    title: 'Андрей Пересыпкин',
                    carName: 'Chery Arrizo 8'
                },
                {
                    image: './image/new_vide_img3.svg',
                    title: 'Татьяна П.',
                    carName: 'Chery Tiggo 4 New'
                },
                {
                    image: './image/new_vide_img1.svg',
                    title: 'Татс Снега',
                    carName: 'Chery Tiggo 7 Pro'
                },
                {
                    image: './image/new_vide_img2.svg',
                    title: 'Анна Иванова',
                    carName: 'Chery Tiggo 8 Pro'
                }
            ];

            // Элементы DOM
            const videoGrid = document.getElementById('videoGrid');
            const videoCarousel = document.getElementById('videoCarousel');
            const leftArrow = document.querySelector('.left-arrow');
            const rightArrow = document.querySelector('.right-arrow');
            
            // Переменные для управления каруселью
            let isScrolling = false;
            let scrollTimeout;
            let isDragging = false;
            let startX = 0;
            let scrollLeft = 0;
            let currentScrollPosition = 0;
            
            // Создание карточек
            function createCards() {
                // Очищаем сетку
                videoGrid.innerHTML = '';
                
                // Создаем карточки
                cardData.forEach((card, index) => {
                    const cardElement = document.createElement('div');
                    cardElement.className = 'video-comments-card';
                    cardElement.style.backgroundImage = `url('${card.image}')`;
                    cardElement.dataset.index = index;
                    
                    cardElement.innerHTML = `
                        <div class="video-comments-play-container">
                            <div class="video-comments-play-btn">
                                <div class="video-comments-play-icon"></div>
                            </div>
                        </div>
                        <div class="video-comments-text-container">
                            <div class="text-content">
                                <h4 class="video-comments-card-title">${card.title}</h4>
                                <span class="video-comments-car-name">${card.carName}</span>
                            </div>
                        </div>
                    `;
                    
                    videoGrid.appendChild(cardElement);
                });
            }
            
            // Клонирование карточек для бесконечного скролла
            function cloneCardsForInfiniteScroll() {
                const cards = videoGrid.querySelectorAll('.video-comments-card');
                const cloneCount = Math.ceil(cards.length / 2);
                
                // Клонируем карточки с конца и добавляем в начало
                for (let i = cards.length - cloneCount; i < cards.length; i++) {
                    const clone = cards[i].cloneNode(true);
                    videoGrid.insertBefore(clone, videoGrid.firstChild);
                }
                
                // Клонируем карточки с начала и добавляем в конец
                for (let i = 0; i < cloneCount; i++) {
                    const clone = cards[i].cloneNode(true);
                    videoGrid.appendChild(clone);
                }
            }
            
            // Настройка Intersection Observer для затемнения
            function setupIntersectionObserver() {
                const observerOptions = {
                    root: videoCarousel,
                    rootMargin: '0px',
                    threshold: [0.1, 0.5, 0.9]
                };
                
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        const card = entry.target;
                        
                        // Если карточка полностью видима
                        if (entry.intersectionRatio >= 0.9) {
                            card.classList.remove('faded');
                        } 
                        // Если карточка частично видима
                        else if (entry.intersectionRatio > 0.3) {
                            card.classList.add('faded');
                        }
                        // Если карточка почти не видима
                        else {
                            card.classList.add('faded');
                        }
                    });
                    
                    // Обновляем градиенты по краям
                    updateEdgeGradients();
                }, observerOptions);
                
                // Наблюдаем за всеми карточками
                const cards = videoGrid.querySelectorAll('.video-comments-card');
                cards.forEach(card => {
                    observer.observe(card);
                });
            }
            
            // Обновление градиентов по краям
            function updateEdgeGradients() {
                const scrollLeft = videoCarousel.scrollLeft;
                const scrollWidth = videoCarousel.scrollWidth;
                const clientWidth = videoCarousel.clientWidth;
                
                // Убираем все классы
                videoCarousel.classList.remove('fade-left', 'fade-right', 'fade-both');
                
                // Если скролл в начале
                if (scrollLeft <= 10) {
                    videoCarousel.classList.add('fade-right');
                }
                // Если скролл в конце
                else if (scrollLeft >= scrollWidth - clientWidth - 10) {
                    videoCarousel.classList.add('fade-left');
                }
                // Если скролл в середине
                else {
                    videoCarousel.classList.add('fade-both');
                }
            }
            
            // Плавный скролл к карточке
            function smoothScrollToCard(direction) {
                if (isScrolling) return;
                
                isScrolling = true;
                const cardWidth = 400 + 24; // ширина карточки + gap
                const scrollAmount = direction === 'next' ? cardWidth : -cardWidth;
                
                videoCarousel.scrollBy({
                    left: scrollAmount,
                    behavior: 'smooth'
                });
                
                setTimeout(() => {
                    isScrolling = false;
                }, 100);
            }
            
            // Обработка бесконечного скролла
            function handleInfiniteScroll() {
                const scrollLeft = videoCarousel.scrollLeft;
                const scrollWidth = videoCarousel.scrollWidth;
                const clientWidth = videoCarousel.clientWidth;
                const cardWidth = 400 + 24; // ширина карточки + gap
                const cards = videoGrid.querySelectorAll('.video-comments-card');
                const originalCardsCount = cardData.length;
                
                // Если достигли начала (клонированные карточки в начале)
                if (scrollLeft <= cardWidth * 2) {
                    // Плавно переходим к настоящим карточкам в конце
                    videoCarousel.scrollLeft = scrollWidth - (cardWidth * (originalCardsCount + 2)) - clientWidth;
                }
                // Если достигли конца (клонированные карточки в конце)
                else if (scrollLeft >= scrollWidth - clientWidth - cardWidth * 2) {
                    // Плавно переходим к настоящим карточкам в начале
                    videoCarousel.scrollLeft = cardWidth * 2;
                }
            }
            
            // Обработчики событий для мобильной версии
            function setupMobileHandlers() {
                if (leftArrow && rightArrow) {
                    leftArrow.addEventListener('click', handleMobilePrev);
                    rightArrow.addEventListener('click', handleMobileNext);
                }
            }
            
            function handleMobilePrev() {
                const cards = document.querySelectorAll('.video-comments-card');
                let currentIndex = 0;
                
                // Находим текущую активную карточку
                cards.forEach((card, index) => {
                    if (card.classList.contains('active')) {
                        currentIndex = index;
                    }
                });
                
                const prevIndex = (currentIndex - 1 + cards.length) % cards.length;
                
                // Убираем активный класс с текущей карточки
                cards[currentIndex].classList.remove('active');
                
                // Добавляем активный класс к предыдущей карточке
                cards[prevIndex].classList.add('active');
                
                // Прокручиваем к карточке
                cards[prevIndex].scrollIntoView({
                    behavior: 'smooth',
                    block: 'nearest',
                    inline: 'center'
                });
            }
            
            function handleMobileNext() {
                const cards = document.querySelectorAll('.video-comments-card');
                let currentIndex = 0;
                
                // Находим текущую активную карточку
                cards.forEach((card, index) => {
                    if (card.classList.contains('active')) {
                        currentIndex = index;
                    }
                });
                
                const nextIndex = (currentIndex + 1) % cards.length;
                
                // Убираем активный класс с текущей карточки
                cards[currentIndex].classList.remove('active');
                
                // Добавляем активный класс к следующей карточке
                cards[nextIndex].classList.add('active');
                
                // Прокручиваем к карточке
                cards[nextIndex].scrollIntoView({
                    behavior: 'smooth',
                    block: 'nearest',
                    inline: 'center'
                });
            }
            
            // Drag & Drop функциональность
            function setupDragHandlers() {
                videoCarousel.addEventListener('mousedown', startDrag);
                videoCarousel.addEventListener('touchstart', startDrag);
                
                videoCarousel.addEventListener('mousemove', duringDrag);
                videoCarousel.addEventListener('touchmove', duringDrag);
                
                videoCarousel.addEventListener('mouseup', endDrag);
                videoCarousel.addEventListener('touchend', endDrag);
                videoCarousel.addEventListener('mouseleave', endDrag);
            }
            
            function startDrag(e) {
                isDragging = true;
                videoCarousel.classList.add('grabbing');
                startX = e.pageX || e.touches[0].pageX;
                scrollLeft = videoCarousel.scrollLeft;
            }
            
            function duringDrag(e) {
                if (!isDragging) return;
                e.preventDefault();
                
                const x = e.pageX || e.touches[0].pageX;
                const walk = (x - startX) * 2;
                videoCarousel.scrollLeft = scrollLeft - walk;
            }
            
            function endDrag() {
                isDragging = false;
                videoCarousel.classList.remove('grabbing');
            }
            
            // Инициализация мобильной версии
            function initMobileCarousel() {
                const cards = document.querySelectorAll('.video-comments-card');
                if (cards.length > 0) {
                    cards[0].classList.add('active');
                }
            }
            
            // Инициализация
            function initCarousel() {
                createCards();
                
                // Проверяем тип устройства
                const isMobile = window.innerWidth <= 768;
                
                if (!isMobile) {
                    // Для десктопа - бесконечный скролл
                    cloneCardsForInfiniteScroll();
                    setupIntersectionObserver();
                    setupDragHandlers();
                    
                    // Устанавливаем начальную позицию скролла
                    setTimeout(() => {
                        const cardWidth = 400 + 24;
                        videoCarousel.scrollLeft = cardWidth * 2;
                    }, 100);
                    
                    // Слушатели событий скролла для бесконечности
                    videoCarousel.addEventListener('scroll', () => {
                        isScrolling = true;
                        
                        // Обрабатываем бесконечный скролл
                        handleInfiniteScroll();
                        
                        // Сбрасываем таймер
                        clearTimeout(scrollTimeout);
                        scrollTimeout = setTimeout(() => {
                            isScrolling = false;
                        }, 100);
                    });
                } else {
                    // Для мобильных - обычный скролл с навигацией
                    setupMobileHandlers();
                    initMobileCarousel();
                }
            }
            
            // Обработчик изменения размера окна
            function handleResize() {
                const isMobile = window.innerWidth <= 768;
                const cards = document.querySelectorAll('.video-comments-card');
                
                if (isMobile) {
                    // Для мобильных убираем классы бесконечного скролла
                    cards.forEach(card => {
                        card.classList.remove('faded');
                    });
                    videoCarousel.classList.remove('fade-left', 'fade-right', 'fade-both');
                }
            }
            
            // Запускаем инициализацию
            initCarousel();
            window.addEventListener('resize', handleResize);
        });
    </script>
</body>
</html>